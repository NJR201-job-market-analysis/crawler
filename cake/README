# Cake çˆ¬èŸ²ç³»çµ±

ç¨‹å¼ç¢¼ä½æ–¼ https://github.com/NJR201-job-market-analysis/crawler/cake

ä¸€å€‹åŸºæ–¼ Celery å’Œ RabbitMQ çš„åˆ†å¸ƒå¼çˆ¬èŸ²ç³»çµ±ï¼Œç”¨æ–¼çˆ¬å– Cake å¹³å°çš„è·ç¼ºè³‡è¨Šã€‚

## ğŸ“ ç›®éŒ„çµæ§‹

```
/root/job-crawler/cake/
â”œâ”€â”€ setup.py                    # Python åŒ…é…ç½®
â”œâ”€â”€ Pipfile                     # Python ä¾è³´ç®¡ç†
â”œâ”€â”€ local.ini                   # ç’°å¢ƒé…ç½®æ–‡ä»¶
â”œâ”€â”€ genenv.py                   # ç’°å¢ƒè®Šæ•¸ç”Ÿæˆå™¨
â”œâ”€â”€ .env                        # ç’°å¢ƒè®Šæ•¸æ–‡ä»¶ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”œâ”€â”€ crawler/                    # çˆ¬èŸ²æ¨¡çµ„ç›®éŒ„
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cake_config.py          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ cake_worker.py          # Celery Worker é…ç½®
â”‚   â”œâ”€â”€ cake_tasks.py           # Celery ä»»å‹™å®šç¾©
â”‚   â”œâ”€â”€ cake_producer.py        # ä»»å‹™ç”Ÿç”¢è€…
â”‚   â”œâ”€â”€ cake_crawler.py         # æ ¸å¿ƒçˆ¬èŸ²é‚è¼¯
â”‚   â””â”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â””â”€â”€ docker-compose.monitor.yml  # Docker ç›£æ§é…ç½®
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒæº–å‚™

```bash
# é€²å…¥é …ç›®ç›®éŒ„
cd /root/job-crawler/cake

# ç”Ÿæˆç’°å¢ƒè®Šæ•¸æ–‡ä»¶
ENV=DOCKER|DEV python genenv.py

# é©—è­‰é…ç½®
pipenv run python -c "from crawler.cake_config import RABBITMQ_HOST; print(f'RABBITMQ_HOST: {RABBITMQ_HOST}')"

# å®‰è£ä¾è³´
pipenv install
```

### 2. å•Ÿå‹• RabbitMQã€MySQLã€Flowerã€PhpMyAdmin

```bash
# ä½¿ç”¨ Docker å•Ÿå‹•
docker compose -f docker-compose.monitor.yml up -d
docker compose -f docker-compose.monitor.yml down -d

# æŸ¥çœ‹å®¹å™¨ç‹€æ…‹
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
```

### 3: å•Ÿå‹• Workerã€Producer

```bash
# çµ‚ç«¯ 1: å•Ÿå‹• Worker
pipenv run celery -A crawler.cake_worker worker --loglevel=info

# çµ‚ç«¯ 3: åŸ·è¡Œ Producer
pipenv run python -m crawler.cake_producer
```

### ç›£æ§ä»»å‹™åŸ·è¡Œ

- **Worker çµ‚ç«¯**: æŸ¥çœ‹ä»»å‹™åŸ·è¡Œæ—¥èªŒ
- **Flower ç•Œé¢**: æŸ¥çœ‹ä»»å‹™ç‹€æ…‹å’Œçµ±è¨ˆ (http://localhost:5555)
- **RabbitMQ ç®¡ç†ç•Œé¢**: æŸ¥çœ‹éšŠåˆ—ç‹€æ…‹ (http://localhost:15672)

### ä»»å‹™é…ç½®

```python
# cake_producer.py
crawl_cake_jobs.delay(
    category="software-developer",    # è·ç¼ºé¡åˆ¥
    job_type="it_front-end-engineer", # è·ä½é¡å‹
    filename="cake_jobs.csv",         # è¼¸å‡ºæ–‡ä»¶å
)
```

## ğŸ“Š ç¨‹å¼ç¢¼æ¶æ§‹

### é…ç½®å±¤ (Configuration Layer)
- **`cake_config.py`**: ç’°å¢ƒè®Šæ•¸ç®¡ç†ï¼Œé€£æ¥ RabbitMQ å’Œ MySQL
- **`local.ini`**: å¤šç’°å¢ƒé…ç½®ï¼ˆDEV/DOCKER/PRODUCTIONï¼‰
- **`genenv.py`**: æ ¹æ“šç’°å¢ƒç”Ÿæˆ `.env` æ–‡ä»¶

### ä»»å‹™å±¤ (Task Layer)
- **`cake_worker.py`**: Celery æ‡‰ç”¨é…ç½®ï¼Œé€£æ¥ RabbitMQ
- **`cake_tasks.py`**: å®šç¾©çˆ¬èŸ²ä»»å‹™å’Œæ¸¬è©¦ä»»å‹™
- **`cake_producer.py`**: ä»»å‹™ç”Ÿç”¢è€…ï¼Œç™¼é€çˆ¬èŸ²ä»»å‹™

### çˆ¬èŸ²å±¤ (Crawler Layer)
- **`cake_crawler.py`**: æ ¸å¿ƒçˆ¬èŸ²é‚è¼¯ï¼Œè§£æ Cake ç¶²ç«™

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **RabbitMQ é€£æ¥å¤±æ•—**
   ```bash
   # æª¢æŸ¥ RabbitMQ æ˜¯å¦é‹è¡Œ
   docker ps | grep rabbitmq
   
   # æª¢æŸ¥ç«¯å£æ˜¯å¦é–‹æ”¾
   netstat -tlnp | grep 5672
   ```

2. **Worker ç„¡æ³•å•Ÿå‹•**
   ```bash
   # æª¢æŸ¥ä¾è³´æ˜¯å¦å®‰è£
   pipenv install
   
   # æª¢æŸ¥é…ç½®æ˜¯å¦æ­£ç¢º
   pipenv run python -c "from crawler.cake_config import *; print(RABBITMQ_HOST)"
   ```

3. **ä»»å‹™åŸ·è¡Œå¤±æ•—**
   ```bash
   # æª¢æŸ¥ Worker æ—¥èªŒ
   pipenv run celery -A crawler.cake_worker worker --loglevel=debug
   
   # æª¢æŸ¥ Flower ç›£æ§ç•Œé¢
   # è¨ªå• http://localhost:5555
   ```

## ğŸ“„ è¼¸å‡ºæ ¼å¼

çˆ¬èŸ²æœƒç”Ÿæˆ CSV æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š
- è·ç¼º
- å…¬å¸
- è¦æ±‚æŠ€èƒ½
- å…¬å¸ç°¡è¿°
- åœ°é»
- è–ªè³‡
- ç¶“é©—

## ğŸš€ å¦‚ä½•æ¸¬è©¦ celery æ˜¯å¦æ­£å¸¸é‹è¡Œ

1. **é€²å…¥è™›æ“¬ç’°å¢ƒ**
   ```bash
   pipenv shell
   ```

2. **å•Ÿå‹• worker**
   ```bash
   # å¦‚æœå·²ç¶“åœ¨è™›æ“¬ç’°å¢ƒ (åœ¨æœ¬åœ°é–‹ç™¼è¦é€™æ¨£ä½¿ç”¨)
   celery -A crawler.cake_worker worker --loglevel=info

   # å¦‚æœä¸åœ¨è™›æ“¬ç’°å¢ƒ (åœ¨ docker ä¸­è¦é€™æ¨£ä½¿ç”¨)
   pipenv run celery -A crawler.cake_worker worker --loglevel=info
   ```

3. **æ¸¬è©¦ç™¼é€ä»»å‹™**
   ```bash
   pipenv run python -m crawler.cake_producer
   ```


è³‡æ–™è¡¨è¦åŠƒ

company
locations
job_type
job_posts
job_skills
